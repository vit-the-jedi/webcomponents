class p{update(t,e){var o;const n=e.getProgressState;t.activeStep===t.maxValue&&((o=this.configs)!=null&&o.removeOnComplete)?e.unmountComponent():(n!=null&&n.pause&&n.pause!==0?(n.pause=Math.max(n.pause-1,0),n.pause===1&&e.setStepsRemainingInState()):(e.removeKeysFromState(["pause","stepChange"]),e.setStepsRemainingInState()),e.updateComponent(Math.ceil(t.activeStep)))}}class c{constructor(){this.queue=[],this.eventListeners={},this.initializeEventListeners()}set createQueue(t){this.queue.create=t}get getCreateQueue(){return this.queue.create}get getEventListeners(){return this.eventListeners}initializeEventListeners(){const t=this.eventListeners;if(!sessionStorage.getItem("component__custom-events-added")){const e=this;document.addEventListener("componentStepValueChange",function(n){const o=n==null?void 0:n.data;o.eventLoopTarget=e.getCreateQueue.indexOf(e.componentBeforeCreate),t[n.type]={data:o}}),document.addEventListener("componentManualStepUpdate",function(n){const o=n==null?void 0:n.data;o.eventLoopTarget=e.getCreateQueue.indexOf(e.componentMounted),t[n.type]={data:o}})}sessionStorage.setItem("component__custom-events-added",!0)}createComponentCreationEventLoop(t=null){this.queue.create=[],this.addEventToQueue("create","componentBeforeCreate"),this.addEventToQueue("create","componentCreated"),this.addEventToQueue("create","componentBeforeMount"),this.addEventToQueue("create","componentMounted"),t&&this.interceptEventLoop(t)}createComponentDestructionEventLoop(){this.queue.destroy=[],this.addEventToQueue("destroy","componentBeforeUnmount"),this.addEventToQueue("destroy","componentUnmounted")}validateEvent(t,e){const n=Object.getPrototypeOf(this);if(this.getCreateQueue.length>1&&this.getCreateQueue.filter(r=>{if(r.name===e)return r}).length>0)return!1;if(typeof n[e]!="function"){const o=new Error;throw o.name="MethodNotFound",o.message=`You must specify a method that is a function, and exists on this observer. Make sure "${e}" is an event handler method on this observer.`,o}return!0}addEventToQueue(t,e,n=null){let o;try{o=this.validateEvent(t,e)}catch(r){console.error(r)}o&&(typeof n=="number"?this.queue[t].splice(n,0,this[e]):this.queue[t].push(this[e]))}interceptEventLoop(t){t.forEach(e=>{const n=this.getEventListeners[e].data.eventLoopTarget;this.addEventToQueue("create",e,n)})}removeItemFromEventLoop(t){this.getCreateQueue.splice(this.getCreateQueue.indexOf(this[t]),1)}checkForEvents(){return new Promise((t,e)=>{Object.keys(this.eventListeners).length>0?t(!0):t(!1)})}dispatchEvents(t,e){this.getCreateQueue.reduce(async(n,o)=>(await n,o.bind(this)(o.name,e)),Promise.resolve())}componentBeforeCreate(t,e){return new Promise((n,o)=>{e.log("Component before create"),e.componentType==="steps"?(e._progressState.stepIncrement=1,e.setActiveStepInState(1)):e.setActiveStepInState(),n(t)})}componentCreated(t,e){return new Promise(async(n,o)=>{await e.createComponent().then(r=>{e.notifyStateUpdate(e._progressState),n(t)})})}componentBeforeMount(t,e){return new Promise((n,o)=>{e.log("Component before mount"),n(t)})}componentMounted(t,e){return new Promise((n,o)=>{e.log("Component mounted"),window.top._customComponentProps={},window.top._customComponentProps.element=e,window.top._customComponentProps.anchor=e.configs.anchorPoint,e.getComponentAnchorPoint().then(()=>{e.mountComponent().then(()=>{e.saveState(),n(t)})})})}componentBeforeUnmount(t){return new Promise((e,n)=>{t.log("Component before unmount"),t.saveState(),e(methodName)})}componentUnmounted(t,e){return new Promise((n,o)=>{e.log("Component unmounted"),n(t)})}componentStepValueChange(t,e){return new Promise((n,o)=>{const r=this.eventListeners.componentStepValueChange.data;e.log("Component step value update");let i;const s=e.getProgressState,a=r.addedSteps?r.addedSteps:r.removedSteps*-1;r.removedSteps?(i=Math.max(s.stepsRemaining+1+a,0),i===0?(s.stepsRemaining=0,s.stepIncrementt=s.maxValue/s.numOfSteps,s.activeStep=s.maxValue,s.percentcomplete=s.maxValue):(s.numOfSteps=i,s.stepsRemaining=i,s.stepIncrement=s.maxValue/i,s.activeStep=s.maxValue-s.stepsRemaining*s.stepIncrement,s.percentcomplete=s.activeStep)):(s.pause=r.addedSteps+1,s.stepChange=a),this.getEventListeners[t].data.once&&(delete this.getEventListeners[t],this.removeItemFromEventLoop(t)),n(t)})}}export{c as E,p as S};
