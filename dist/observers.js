class c{update(n,e){const t=e.getProgressState;t!=null&&t.pause&&t.pause!==0?(t.pause=Math.max(t.pause-1,0),t.pause===1&&e.setStepsRemainingInState()):(e.removeKeysFromState(["pause","stepChange"]),e.setStepsRemainingInState()),e.updateComponent(Math.ceil(n.activeStep))}}class p{constructor(){this.queue=[],this.eventListeners={},this.initializeEventListeners()}set createQueue(n){this.queue.create=n}get getCreateQueue(){return this.queue.create}get getEventListeners(){return this.eventListeners}initializeEventListeners(){const n=this.eventListeners;if(!sessionStorage.getItem("custom-component__eventsRegistered")){const e=this;document.addEventListener("componentStepValueChange",function(t){try{const o=t==null?void 0:t.data;if(o)o.eventLoopTarget=e.getCreateQueue.indexOf(e.componentBeforeCreate),n[t.type]={data:o};else{const r=new Error;throw r.name="MissingEventData",r.message=`Missing critical data for ${t.type}. Go back to where you have dispatched this event from, and be sure to add a data object to the event.`,r}}catch(o){console.error(o)}}),document.addEventListener("componentManualStepUpdate",function(t){const o=t==null?void 0:t.data;o.eventLoopTarget=e.getCreateQueue.indexOf(e.componentMounted),n[t.type]={data:o}})}sessionStorage.setItem("custom-component__eventsRegistered",!0)}createComponentCreationEventLoop(n=null){this.queue.create=[],this.addEventToQueue("create","componentBeforeCreate"),this.addEventToQueue("create","componentCreated"),this.addEventToQueue("create","componentBeforeMount"),this.addEventToQueue("create","componentMounted"),n&&this.interceptEventLoop(n)}createComponentDestructionEventLoop(){this.queue.destroy=[],this.addEventToQueue("destroy","componentBeforeUnmount"),this.addEventToQueue("destroy","componentUnmounted")}validateEvent(n,e){const t=Object.getPrototypeOf(this);if(this.getCreateQueue.length>1&&this.getCreateQueue.filter(r=>{if(r.name===e)return r}).length>0)return!1;if(typeof t[e]!="function"){const o=new Error;throw o.name="MethodNotFound",o.message=`You must specify a method that is a function, and exists on this observer. Make sure "${e}" is an event handler method on this observer.`,o}return!0}addEventToQueue(n,e,t=null){let o;try{o=this.validateEvent(n,e)}catch(r){console.error(r)}o&&(typeof t=="number"?this.queue[n].splice(t,0,this[e]):this.queue[n].push(this[e]))}interceptEventLoop(n){n.forEach(e=>{const t=this.getEventListeners[e].data.eventLoopTarget;this.addEventToQueue("create",e,t)})}removeItemFromEventLoop(n){this.getCreateQueue.splice(this.getCreateQueue.indexOf(this[n]),1)}checkForEvents(){return new Promise((n,e)=>{Object.keys(this.eventListeners).length>0?n(!0):n(!1)})}eventWrapper(n,e,t){return new Promise((o,r)=>{try{n(e,t).then(a=>{o(a)})}catch(a){o(a)}})}dispatchEvents(n,e){var t;(t=this.queue[n])==null||t.reduce(async(o,r)=>{await o;const a=r.bind(this);return this.eventWrapper(a,r.name,e)},Promise.resolve())}componentBeforeCreate(n,e){return new Promise((t,o)=>{e.log("Component before create"),e.componentType==="steps"?(e._progressState.stepIncrement=1,e.setActiveStepInState(1)):e.setActiveStepInState(),t(n)})}componentCreated(n,e){return new Promise(async(t,o)=>{await e.createComponent().then(r=>{e.checkIfComplete()?(e.unmountComponent(),e.log("Component lifecycle cancelled. This is a manual action, most likely because configs.removeOnComplete is set to true."),this.queue.create=[],sessionStorage.setItem("custom-component__done",!0)):(e.notifyStateUpdate(e._progressState),t(n))})})}componentBeforeMount(n,e){return new Promise((t,o)=>{e.log("Component before mount"),t(n)})}componentMounted(n,e){return new Promise((t,o)=>{e.log("Component mounted"),window.top._customComponentProps={},window.top._customComponentProps.element=e,window.top._customComponentProps.anchor=e.configs.anchorPoint,e.getComponentAnchorPoint().then(()=>{e.mountComponent().then(()=>{e.saveState(),t(n)})})})}componentStepValueChange(n,e){return new Promise((t,o)=>{const r=this.eventListeners.componentStepValueChange.data;e.log("Component step value update");let a;const s=e.getProgressState,i=r.addedSteps?r.addedSteps:r.removedSteps*-1;r.removedSteps?(a=Math.max(s.stepsRemaining+1+i,0),a===0?(s.stepsRemaining=0,s.stepIncrementt=s.maxValue/s.numOfSteps,s.activeStep=s.maxValue,s.percentcomplete=s.maxValue):(s.numOfSteps=a,s.stepsRemaining=a,s.stepIncrement=s.maxValue/a,s.activeStep=s.maxValue-s.stepsRemaining*s.stepIncrement,s.percentcomplete=s.activeStep)):(s.pause=r.addedSteps+1,s.stepChange=i),this.getEventListeners[n].data.once&&(delete this.getEventListeners[n],this.removeItemFromEventLoop(n)),t(n)})}}export{p as E,c as S};
