var m=Object.defineProperty;var h=(i,n,t)=>n in i?m(i,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[n]=t;var c=(i,n,t)=>(h(i,typeof n!="symbol"?n+"":n,t),t);import{S as d,E as u}from"./observers.js";const r=new u;class v extends HTMLElement{constructor(){super();c(this,"startPageChangeListener",t=>{if(!this.getProgressState.pageObserverAdded){const e=(o,p)=>{for(const a of o)if(a.addedNodes.length>0&&a.addedNodes[0].classList.contains("page")){const g=a.addedNodes[0].id.slice(2);if(!Impressure.context.getState().pages[g].name.toLowerCase().includes("integration")){window.initProgressComponent(this.configs);break}}};new MutationObserver(e).observe(document.querySelector(".survey"),{childList:!0}),this.getProgressState.pageObserverAdded=!0}});this._listeners={},this.observers={},this._progressState={},this._configs={},this._devMode=!0,this.addObserver(new d,"state"),this.addObserver(r,"event"),this.initializeEventListeners()}set setProgressState(t){this.log("setting progress state"),this.log(t),this._progressState=t}get getProgressState(){return this._progressState}set percentcomplete(t){this._progressState.percentcomplete=t}get percentcomplete(){return this._progressState.percentcomplete}set setStepsRemaining(t){this._progressState.stepsRemaining=t}get getStepsRemaining(){return this._progressState.stepsRemaining}set configs(t){this._configs=t}get configs(){return this._configs}get componentType(){return this.configs.type}set impressurePageId(t){this.impressurePageHistory.push(t)}initializeEventListeners(){const t=this;sessionStorage.getItem("custom-component__eventsRegistered")||(document.addEventListener("componentStepValueChange",function(e){try{const s=e==null?void 0:e.data;if(s)s.eventLoopTarget=r.getCreateQueue.indexOf(r.componentBeforeCreate),t.notifyEventUpdate({name:e.type,data:s});else{const o=new Error;throw o.name="MissingEventData",o.message=`Missing critical data for ${e.type}. Go back to where you have dispatched this event from, and be sure to add a data object to the event.`,o}}catch(s){console.error(s)}}),document.addEventListener("componentManualStepUpdate",function(e){const s=e==null?void 0:e.data;s.eventLoopTarget=r.getCreateQueue.indexOf(r.componentMounted),t.notifyEventUpdate({name:e.type,data:s})})),sessionStorage.setItem("custom-component__eventsRegistered",!0)}addObserver(t,e){this.observers[e]||(this.observers[e]=[]),this.observers[e].push(t)}removeObserver(t){const e=this.observers.indexOf(t);e>-1&&this.observers.splice(e,1)}notifyStateUpdate(t){this.observers.state.forEach(async e=>e.update(t,this))}notifyEventUpdate(t){this.observers.event.forEach(async e=>e.update(t,this))}log(t){this._devMode&&console.log(t)}isImpressureEmbedded(){return!!window.top.Impressure}pushImpressurePageId(){}async initState(t){this.isImpressureEmbedded()&&(this.impressurePageHistory=[]),this.configs=t;const e=JSON.parse(sessionStorage.getItem("custom-component__state"));if(e)this.setProgressState=e._progressState,this.configs=e._configs;else{const s=this.configs.steps,o=this.configs.type,p=this.configs.max,a=Number((o==="steps"?1:p/s).toFixed(2));this.setProgressState={activeStep:0,numOfSteps:s,stepIncrement:a,steps:new Map,percentcomplete:0,maxValue:p,stepsRemaining:s}}r.createComponentCreationEventLoop(),r.dispatchEvents("create",this)}setStepToList(t,e){this._progressState.steps.set(t,e)}getStepFromList(t){return this._progressState.steps.get(t)}getStepsListFromState(){return this._progressState.steps}setActiveStepInState(){let t;const e=this.getProgressState;e!=null&&e.pause&&(e==null?void 0:e.pause)!==0?t=Number((e.activeStep+e.stepIncrement/e.stepChange).toFixed(2)):t=e.activeStep+e.stepIncrement>e.maxValue?e.maxValue:e.activeStep+e.stepIncrement,e.activeStep=t}setStepsRemainingInState(){this.setStepsRemaining=Math.max(this.getStepsRemaining-1,0)}updateComponent(t){this.percentcomplete=t,this.setAttribute("percentcomplete",t)}checkIfComplete(){var e;const t=this.getProgressState;return Math.round(t.activeStep)===t.maxValue?(this.deleteState(),(e=this.configs)!=null&&e.removeOnComplete&&r.dispatchEvents("destroy",this),!0):!1}mountComponent(){return new Promise(t=>{this.getAnchorPoint(this.configs.anchorPoint).then(e=>{e.parentElement.insertBefore(this,e.nextElementSibling)}).then(()=>{t()})})}unmountComponent(){this&&this.parentElement&&this.parentElement.removeChild(this)}getState(){return{_progressState:this.getProgressState,_listeners:this._listeners,_configs:this.configs}}saveState(){sessionStorage.setItem("custom-component__state",JSON.stringify(this.getState()))}deleteState(){sessionStorage.removeItem("custom-component__state")}removeKeysFromState(t){for(const e of t)delete this.getProgressState[e]}createGlobalStyles(){const t=`
        .progress-wrapper {
            transition-property: all;
            transition-duration: ${this.configs.transitionDuration/1e3}s;
            transition-timing-function: ease-in;
            opacity: 1;
        }
        .updating {
            opacity: 0;
        }
        `,e=document.createElement("style");return e.textContent=t,e}}export{v as P};
