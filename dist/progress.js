class r extends HTMLElement{constructor(){super(),this._listeners={}}log(t){this._devMode&&console.log(t)}initState(t){this.log("component initialized"),this.configs=t,t._devMode&&(this._devMode=!0,delete t._devMode),this._progressState={},this._progressState.activeStep=0,this._progressState.stepsRemaining=this._numOfSteps,this._progressState.steps=new Map,this.progressElement=null}initFromLastKnownState(t){this.log("component initialized from last known state"),this.setConfigs(t.configs),this.registerEvents(this==null?void 0:this.getConfigs("optionalEvents")),this._percentcomplete=t._percentcomplete,this._numOfSteps=t._numOfSteps,this._maxValue=t._maxValue,this._stepIncrement=t._stepIncrement,this._progressState.activeStep=t._progressState.activeStep,this._progressState.stepsRemaining=t._progressState.stepsRemaining,!(this.configs.type==="steps"&&this.getConfigs("manualUpdate")&&this._listeners.unmounted)&&this.setActiveStepInState()}setConfigs(t){this.configs=t}getConfigs(t){return this.configs[t]}setStepToList(t,e){this._progressState.steps.set(t,e)}getStepFromList(t){return this._progressState.steps.get(t)}getStepsListFromState(){return this._progressState.steps}getActiveStepFromState(){return this._progressState.activeStep}setActiveStepInState(){const t=this._progressState.activeStep+this._stepIncrement>this._maxValue?this._maxValue:this._progressState.activeStep+this._stepIncrement;this._progressState.activeStep=t,t===this._maxValue&&this.configs.removeOnComplete?this.removeComponent():(this._progressState.stepsRemaining=Math.max(this._progressState.stepsRemaining-1,0),this.updateComponent())}getState(){return{_maxValue:this._maxValue,_numOfSteps:this._numOfSteps,_percentcomplete:this._percentcomplete,_progressState:this._progressState,_stepIncrement:this._stepIncrement,_listeners:this._listeners,configs:this.configs}}saveState(){const t=this.getState();t._progressState&&sessionStorage.setItem("custom-component__state",JSON.stringify(t))}registerEvents(t=null){const e=this;if(Object.keys(this._listeners).length===0&&(document.addEventListener("componentCreated",function(n,s){e._listeners.created=!0,e.eventDispatcher(n.type,s)}),document.addEventListener("componentBeforeMount",function(n,s){e._listeners.beforeMount=!0,e.eventDispatcher(n.type,s)}),document.addEventListener("componentMounted",function(n,s){e._listeners.mounted=!0,window.top._customComponentProps={},window.top._customComponentProps.element=e,window.top._customComponentProps.anchor=e.getConfigs("anchorPoint"),e.eventDispatcher(n.type,s)}),document.addEventListener("componentUnmounted",function(n,s){e._listeners.unmounted=!0,e.eventDispatcher(n.type,s)}),document.addEventListener("componentStepValueChange",function(n,s){e._listeners.stepValueChange=!0,e.eventDispatcher(n.type,n)}),t))for(const n of t)document.addEventListener(n,function(s,o){e._listeners[n]=!0,e.eventDispatcher(s.type,s)})}updateComponent(){this._percentcomplete=Math.ceil(this.getActiveStepFromState()),this.setAttribute("percentcomplete",Math.ceil(this._percentcomplete)),this.log(this.getState())}eventDispatcher(t,e){switch(t){case"componentMounted":this.getComponentAnchorPoint().then(()=>{this._maxValue=Number(this.getAttribute("data-max")),this._numOfSteps=Number(this.getAttribute("data-steps")),this._progressState.stepsRemaining=this._numOfSteps,this.configs.type==="steps"?(this._stepIncrement=1,this.setActiveStepInState(1)):(this._stepIncrement=this._maxValue/this._numOfSteps,this.setActiveStepInState())});break;case"componentUnmounted":this.saveState();break;case"componentStepValueChange":this.log("step value update received");let n=e.addedSteps?e.addedSteps:e.removedSteps*-1;const s=Math.max(this._progressState.stepsRemaining+1+n,0);s===0?(this._progressState.stepsRemaining=0,this._stepIncrement=this._maxValue/this._numOfSteps,this._progressState.activeStep=this._maxValue,this._percentcomplete=this._maxValue):(this._numOfSteps=s,this._progressState.stepsRemaining=s,this._stepIncrement=this._maxValue/s,this._progressState.activeStep=this._maxValue-this._progressState.stepsRemaining*this._stepIncrement,this._percentcomplete=this._progressState.activeStep),this.setActiveStepInState(),this.saveState();break;case"componentManualProgressStepUpdate":this.log("manual component update fired."),this.setActiveStepInState(),this.saveState();break}}removeComponent(){this&&this.parentElement&&(this.parentElement.removeChild(this),document.dispatchEvent(new Event("componentUnmounted")))}createGlobalStyles(){const t=`
        .progress-wrapper {
            transition-property: all;
            transition-duration: ${this.getConfigs("transitionDuration")/1e3}s;
            transition-timing-function: ease-in;
            opacity: 1;
        }
        .updating {
            opacity: 0;
        }
        `,e=document.createElement("style");return e.textContent=t,e}}export{r as P};
